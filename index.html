<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Zeropush-android-demo by ZeroPush</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Zeropush-android-demo</h1>
        <p>a demo project showing how to integrate with the ZeroPush API</p>

        <p class="view"><a href="https://github.com/ZeroPush/ZeroPush-Android-Demo">View the Project on GitHub <small>ZeroPush/ZeroPush-Android-Demo</small></a></p>


        <ul>
          <li><a href="https://github.com/ZeroPush/ZeroPush-Android-Demo/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/ZeroPush/ZeroPush-Android-Demo/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/ZeroPush/ZeroPush-Android-Demo">View On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <h1>
<a name="zeropush-android-demo" class="anchor" href="#zeropush-android-demo"><span class="octicon octicon-link"></span></a>ZeroPush-Android-Demo</h1>

<p>A demo project showing how to integrate with the ZeroPush API.</p>

<h2>
<a name="background" class="anchor" href="#background"><span class="octicon octicon-link"></span></a>Background</h2>

<p>ZeroPush uses GCM's CCS(XMPP) gateway for sending push notifications. The XMPP
protocol has a number of advantages. We maintain a persistent connection to GCM
so there is low overhead when making many requests.  This also allows us to
perform fast broadcasts to all of your registered devices and are not
limited to 10,000. We use the same efficient connection handling model we employ
when sending push notifications through the APNS gateway.</p>

<h2>
<a name="prerequisites" class="anchor" href="#prerequisites"><span class="octicon octicon-link"></span></a>Prerequisites</h2>

<p>Get a Project Number and API Key from Google Developers Console. Follow these
<a href="http://developer.android.com/google/gcm/gs.html">instructions</a>.</p>

<h2>
<a name="setup" class="anchor" href="#setup"><span class="octicon octicon-link"></span></a>Setup</h2>

<ol>
<li><p>Create an Android app on the ZeroPush site.</p></li>
<li><p>Include the <code>zeropush-sdk</code> module in your project. In Android Studio:
<em>File -&gt; Import Module...</em>. When you reference the module, Android Studio should
offer to add the dependency.</p></li>
<li>
<p>Call setup method in main activity.</p>

<div class="highlight highlight-java"><pre><span class="kd">private</span> <span class="n">ZeroPush</span> <span class="n">zeroPush</span><span class="o">;</span>

<span class="nd">@Override</span>
<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">activity_notifications</span><span class="o">);</span>
    <span class="n">zeroPush</span> <span class="o">=</span> <span class="k">new</span> <span class="nf">ZeroPush</span><span class="o">(</span><span class="s">"zeropush-app-token"</span><span class="o">,</span> <span class="s">"gcm-project-number"</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="n">zeroPush</span><span class="o">.</span><span class="na">registerForRemoteNotifications</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>

<p>You will probably want to register again in the <code>onResume</code> method as
well. This ensures that if the user returns to the running app through some other
means, such as through the back button, the registration is still performed.</p>
</li>
<li>
<p>Add a receiver to handle the received push notifications and subclass ZeroPushBroadcastReceiver:</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">IntentReceiver</span> <span class="kd">extends</span> <span class="n">ZeroPushBroadcastReceiver</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPushReceived</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>
      <span class="n">Log</span><span class="o">.</span><span class="na">d</span><span class="o">(</span><span class="s">"PushReceived"</span><span class="o">,</span> <span class="n">extras</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</li>
<li>
<p>Add permissions to <code>AndroidManifest.xml</code>. Now that we have a class to act
as the receiver, we need to configure it inside of <code>&lt;application&gt;</code>. Add the following declarations:</p>

<div class="highlight highlight-xml"><pre><span class="nt">&lt;application&gt;</span>
  ...
  <span class="nt">&lt;meta-data</span> <span class="na">android:name=</span><span class="s">"com.google.android.gms.version"</span> <span class="na">android:value=</span><span class="s">"@integer/google_play_services_version"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;receiver</span>
      <span class="na">android:name=</span><span class="s">".IntentReceiver"</span>
      <span class="na">android:permission=</span><span class="s">"com.google.android.c2dm.permission.SEND"</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;intent-filter&gt;</span>
          <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.android.c2dm.intent.RECEIVE"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"com.google.android.c2dm.intent.REGISTRATION"</span> <span class="nt">/&gt;</span>
          <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"com.zeropush.zeropush_gcm_demo"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/intent-filter&gt;</span>
  <span class="nt">&lt;/receiver&gt;</span>

  <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.INTERNET"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.GET_ACCOUNTS"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"android.permission.WAKE_LOCK"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"com.google.android.c2dm.permission.RECEIVE"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;permission</span> <span class="na">android:name=</span><span class="s">"com.zeropush.zeropush_gcm_demo.permission.C2D_MESSAGE"</span>
      <span class="na">android:protectionLevel=</span><span class="s">"signature"</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;uses-permission</span> <span class="na">android:name=</span><span class="s">"com.zeropush.zeropush_gcm_demo.permission.C2D_MESSAGE"</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/application&gt;</span>
</pre></div>

<p>Remember to replace <code>com.zeropush.zeropush_gcm_demo</code> with the package of your app.</p>
</li>
</ol>

<h2>
<a name="handle-a-push-notification" class="anchor" href="#handle-a-push-notification"><span class="octicon octicon-link"></span></a>Handle a Push Notification</h2>

<ol>
<li>
<p>Create a simple notification to display</p>

<div class="highlight highlight-java"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">IntentReceiver</span> <span class="kd">extends</span> <span class="n">ZeroPushBroadcastReceiver</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onPushReceived</span><span class="o">(</span><span class="n">Context</span> <span class="n">context</span><span class="o">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="o">,</span> <span class="n">Bundle</span> <span class="n">extras</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">NotificationManager</span> <span class="n">manager</span> <span class="o">=</span> <span class="o">(</span><span class="n">NotificationManager</span><span class="o">)</span><span class="n">context</span><span class="o">.</span><span class="na">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">NOTIFICATION_SERVICE</span><span class="o">);</span>
        <span class="n">PendingIntent</span> <span class="n">pendingIntent</span> <span class="o">=</span> <span class="n">PendingIntent</span><span class="o">.</span><span class="na">getActivity</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="k">new</span> <span class="nf">Intent</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">YourMainActivity</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="mi">0</span><span class="o">);</span>

        <span class="n">Notification</span> <span class="n">notification</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Notification</span><span class="o">.</span><span class="na">Builder</span><span class="o">(</span><span class="n">context</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setContentTitle</span><span class="o">(</span><span class="s">"Got it!"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setContentText</span><span class="o">(</span><span class="n">extras</span><span class="o">.</span><span class="na">toString</span><span class="o">())</span>
                <span class="o">.</span><span class="na">setSmallIcon</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">drawable</span><span class="o">.</span><span class="na">ic_launcher</span><span class="o">)</span>
                <span class="o">.</span><span class="na">setContentIntent</span><span class="o">(</span><span class="n">pendingIntent</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>

        <span class="n">manager</span><span class="o">.</span><span class="na">notify</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="n">notification</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></div>
</li>
</ol>

<h2>
<a name="send-a-broadcast" class="anchor" href="#send-a-broadcast"><span class="octicon octicon-link"></span></a>Send a broadcast</h2>

<p>We support all of the CCS parameters documented here: <a href="https://developer.android.com/google/gcm/server.html#params">https://developer.android.com/google/gcm/server.html#params</a></p>

<div class="highlight highlight-shell"><pre>curl https://api.zeropush.com/broadcast <span class="se">\</span>
  -d <span class="nv">auth_token</span><span class="o">=</span>auth_token <span class="se">\</span>
  -d data<span class="o">[</span>alert<span class="o">]=</span>hello <span class="se">\</span>
  -d data<span class="o">[</span>title<span class="o">]=</span>Test <span class="se">\</span>
  -d <span class="nv">collapse_key</span><span class="o">=</span>friend_request <span class="se">\</span>
  -d <span class="nv">delay_while_idle</span><span class="o">=</span><span class="nb">false</span> <span class="se">\</span>
  -d <span class="nv">time_to_live</span><span class="o">=</span><span class="m">40320</span> <span class="se">\</span>
</pre></div>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/ZeroPush">ZeroPush</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>
    
  </body>
</html>